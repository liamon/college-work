<!DOCTYPE html>
<html>
<head>
	<title>Assignment 2 - Question 2</title>
	<script type="text/javascript">
		function numForm() {
			for (var i = 1; i < 5; i++) {
				var numInput = document.createElement("input");
				numInput.setAttribute("type", "number"); // Prevents non-numbers from being entered, so no need to have a function to check
				numInput.setAttribute("id", "num" + i);
				document.body.appendChild(numInput);
				
				/* This next bit with the linebreaks is purely to make the page look nicer */
				var br = document.createElement("br");
				document.body.appendChild(br);
				if (i != 4) { // This decreases spacing between last input and next heading
					br = document.createElement("br");
					document.body.appendChild(br);
				}
			}
		}

		function twoLineBreaks() {
			for (var i = 0; i < 2; i++) {
				var br = document.createElement("br");
				document.body.appendChild(br);
			}
		}
		
		function generatePage() {
			/*
			In my original version of this assignment, I dealt with the style by directly putting in a style
			tag with the CSS rules in the head. However, after the assignment was corrected, I modified it
			to check my understanding and test my knowledge by replacing it with another DOM manipulation.
			*/
			var styleTag = document.createElement("style");
			var styleText = document.createTextNode('h1 { font-size: 19px; } \
                                                     input[type="number"] { text-align: right; width: 192px; 3} \
                                                     input#op { width: 105px; } \
                                                     #errorMsg { color: red; font-weight: bold; font-size: 18px; }');
			styleTag.appendChild(styleText);
			document.head.appendChild(styleTag);

			var numHeading = document.createElement("h1");
			var numHeadText = document.createTextNode("Numbers");
			numHeading.appendChild(numHeadText);
			document.body.appendChild(numHeading);
			numForm();
			
			var opHeading = document.createElement("h1");
			var opHeadText = document.createTextNode("Operator");
			opHeading.appendChild(opHeadText);
			document.body.appendChild(opHeading);
			
			var opInput = document.createElement("input");
			opInput.setAttribute("type", "text");
			opInput.setAttribute("id", "op");
			document.body.appendChild(opInput);
			twoLineBreaks();
			
			var btn = document.createElement("button");
			var btnTxt = document.createTextNode("Apply")
			btn.appendChild(btnTxt);
			btn.setAttribute("type", "button");
			btn.setAttribute("onclick", "apply( getStack(), getOp() );");
			document.body.appendChild(btn);

			twoLineBreaks();
			var errorMsg = document.createElement("div");
			errorMsg.setAttribute("id", "errorMsg");
			document.body.appendChild(errorMsg);
		}
		
		function getStack() {
			var stack = [];
			for (var i = 1; i < 5; i++) {
				var numInput = document.getElementById("num" + i);
				stack[i - 1] = numInput.value;
			}
			return stack;
		}
		
		function getOp() {
			var opInput = document.getElementById("op");
			var op = opInput.value;
			return op;
		}
		
		function apply(stack, op) {
			var errorMsg = document.getElementById("errorMsg");
			if (errorMsg.hasChildNodes()) { // First time around, errorMsg will have no text and so no childNodes
				errorMsg.removeChild(errorMsg.childNodes[0]); // Clear any past error messages and remove need to declare this in the default
			}
			
			var arg1, arg2, result; // Can declare these variables here to avoid declaring them in each case statement
			arg1 = stack.pop(); // arg1 used in every case so is declared before switch statement, now no need to do it in each case
			while (arg1 == "") {
				arg1 = stack.pop();
			}
			
			if (op != "neg" && op != "sqrt") {
				if (stack[ stack.length - 1 ] == "") {
					errorMsg.textContent = "Error: An input field has been left blank.";
					return; // Prevent "" being pushed onto the stack and making the last filled input field empty
				}
			}
			
			switch ( op.toLowerCase() ) {
				case '+':
					if (stack.length < 1) { // Needed for this and the next three to ensure there is still one left to get from the stack
						errorMsg.textContent = 'Please enter enough numbers for the operator "' + op + '" to operate on.';
						return;
					}
					arg2 = stack.pop();
					result = parseFloat(arg1) + parseFloat(arg2); // Must parseFloat both or they will be strings and be concatenated
					break;
				
				case '-':
					if (stack.length < 1) {
						errorMsg.textContent = 'Please enter enough numbers for the operator "' + op + '" to operate on.';
						return;
					}
					arg2 = stack.pop();
					result = arg1 - arg2;
					break;
				
				case '*':
					if (stack.length < 1) {
						errorMsg.textContent = 'Please enter enough numbers for the operator "' + op + '" to operate on.';
						return;
					}
					arg2 = stack.pop();
					result = arg1 * arg2;
					break;
				
				case '/':
					if (stack.length < 1) {
						errorMsg.textContent = 'Please enter enough numbers for the operator "' + op + '" to operate on.';
						return;
					}
					arg2 = stack.pop();

					if (arg2 == 0) {
						errorMsg.textContent = "Error: You cannot divide any number by 0.";
						return; // Prevent null being pushed onto the stack and making the last filled input field empty
					}
					result = arg1 / arg2;
					break;
				
				case 'neg':
					if (arg1 == undefined) {
						// As the while loop earlier on gets rid of empty strings, if all inputs are blank arg1 will be undefined, not ""
						errorMsg.textContent = "Please enter a number.";
						return;
					}
					result = -arg1;
					break;
				
				case 'sqrt':
					if (arg1 < 0) {
						errorMsg.textContent = "Error: Real negative numbers do not have square roots.";
						return;
					}
					if (arg1 == undefined) {
						errorMsg.textContent = "Please enter a number.";
						return;
					}
					result = Math.sqrt(arg1);
					break;
				
				case "":
					errorMsg.textContent = "Please enter one of the operators +, -, *, /, neg or sqrt.";
					return;
				
				default:
					errorMsg.textContent = "Please only enter one of the operators +, -, *, /, neg or sqrt.";
					return;
			}
			
			stack.push(result);
			for (var i = 1; i < 5; i++) {
				var numInput = document.getElementById("num" + i);
				numInput.value = stack[i - 1];
			}
		}
	</script>
</head>
<body onload="generatePage();">

</body>
</html>
